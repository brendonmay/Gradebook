<template name="paymentModal">
    <div id="paymentModalId" class="modal">
        <div class="modal-content">
            <h4>Purchase Subscription</h4>
            <!-- Content Here -->
            <div id="dropin-wrapper">
                <div id="checkout-message"></div>
                <div id="dropin-container"></div>
            </div>
            <script>
                var button = document.querySelector('#submit-button');

                braintree.dropin.create({
                    // Insert your tokenization key here
                    authorization: 'sandbox_9cc8pqzx_4swbx6vm2kn64w2p',
                    container: '#dropin-container'
                }, function (createErr, instance) {
                    button.addEventListener('click', function () {
                        var currentUser = Meteor.users.findOne({ _id: Meteor.userId() });
                        var expirationDate = currentUser.subscribed.expirationDate;
                        var newExpirationDate

                        instance.requestPaymentMethod(function (requestPaymentMethodErr, payload) {
                            // When the user clicks on the 'Submit payment' button this code will send the
                            // encrypted payment information in a variable called a payment method nonce
                            Meteor.call('createPayment', payload, function () {
                                if (requestPaymentMethodErr){
                                    return false
                                }
                                console.log("transaction went through");
                                // document.getElementById("preloader-full").style = "display: none";
                                $('#paymentModalId').modal('close');
                                $('#successfulPayment').modal('open');
                            });
                        });
                    });
                });
            </script>
        </div>
        <div class="modal-footer">
            <button id="submit-button" class="waves-effect waves-grey btn-flat">Submit payment</button>
            <button class="modal-action modal-close waves-effect waves-grey btn-flat">Close</button>
        </div>
    </div>
</template>